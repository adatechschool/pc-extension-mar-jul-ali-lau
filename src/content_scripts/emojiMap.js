let dictionaryBadWords = new Map();
dictionaryBadWords.set("allumeuse", "ğŸŒ¸");
dictionaryBadWords.set("babtou", "ğŸŒ¸");
dictionaryBadWords.set("bamboula", "ğŸŒ¸");
dictionaryBadWords.set("bÃ¢tard", "ğŸŒ¸");
dictionaryBadWords.set("bÃ¢tard noir", "ğŸŒ¸");
dictionaryBadWords.set("bÃ©casse", "ğŸŒ¸");
dictionaryBadWords.set("bimbo", "ğŸŒ¸");
dictionaryBadWords.set("blondasse", "ğŸŒ¸");
dictionaryBadWords.set("bobonne", "ğŸŒ¸");
dictionaryBadWords.set("bonasse", "ğŸŒ¸");
dictionaryBadWords.set("boniche", "ğŸŒ¸");
dictionaryBadWords.set("boucaque", "ğŸŒ¸");
dictionaryBadWords.set("bouffeur de chiens", "ğŸŒ¸");
dictionaryBadWords.set("bouffeuse de chiens", "ğŸŒ¸");
dictionaryBadWords.set("bougnoule", "ğŸŒ¸");
dictionaryBadWords.set("cagole", "ğŸŒ¸");
dictionaryBadWords.set("catin", "ğŸŒ¸");
dictionaryBadWords.set("chagnasse", "ğŸŒ¸");
dictionaryBadWords.set("chaudasse", "ğŸŒ¸");
dictionaryBadWords.set("chinetoque", "ğŸŒ¸");
dictionaryBadWords.set("ching chong", "ğŸŒ¸");
dictionaryBadWords.set("connard", "ğŸŒ¸");
dictionaryBadWords.set("connasse", "ğŸŒ¸");
dictionaryBadWords.set("crouille", "ğŸŒ¸");
dictionaryBadWords.set("dÃ©bile", "ğŸŒ¸");
dictionaryBadWords.set("donzelle", "ğŸŒ¸");
dictionaryBadWords.set("enculÃ©", "ğŸŒ¸");
dictionaryBadWords.set("enculer", "ğŸŒ¸");
dictionaryBadWords.set("fais pas ta meuf", "ğŸŒ¸");
dictionaryBadWords.set("fatma", "ğŸŒ¸");
dictionaryBadWords.set("FDP", "ğŸŒ¸");
dictionaryBadWords.set("fille de joie", "ğŸŒ¸");
dictionaryBadWords.set("fille facile", "ğŸŒ¸");
dictionaryBadWords.set("fille lÃ©gÃ¨re", "ğŸŒ¸");
dictionaryBadWords.set("fils de pute", "ğŸŒ¸");
dictionaryBadWords.set("fils de putain", "ğŸŒ¸");
dictionaryBadWords.set("fiotte", "ğŸŒ¸");
dictionaryBadWords.set("garce", "ğŸŒ¸");
dictionaryBadWords.set("gogole", "ğŸŒ¸");
dictionaryBadWords.set("gonzesse", "ğŸŒ¸");
dictionaryBadWords.set("gouine", "ğŸŒ¸");
dictionaryBadWords.set("grognasse", "ğŸŒ¸");
dictionaryBadWords.set("grosse vache", "ğŸŒ¸");
dictionaryBadWords.set("hystÃ©rique", "ğŸŒ¸");
dictionaryBadWords.set("macaque", "ğŸŒ¸");
dictionaryBadWords.set("mal-baisÃ©", "ğŸŒ¸");
dictionaryBadWords.set("mal-baisÃ©e", "ğŸŒ¸");
dictionaryBadWords.set("mÃ©gÃ¨re", "ğŸŒ¸");
dictionaryBadWords.set("nÃ¨gre", "ğŸŒ¸");
dictionaryBadWords.set("nÃ©gresse", "ğŸŒ¸");
dictionaryBadWords.set("nÃ©gro", "ğŸŒ¸");
dictionaryBadWords.set("niakouÃ©", "ğŸŒ¸");
dictionaryBadWords.set("niakouÃ©e", "ğŸŒ¸");
dictionaryBadWords.set("niaquÃ©", "ğŸŒ¸");
dictionaryBadWords.set("niaquÃ©e", "ğŸŒ¸");
dictionaryBadWords.set("niaquouÃ©", "ğŸŒ¸");
dictionaryBadWords.set("niaquouÃ©e", "ğŸŒ¸");
dictionaryBadWords.set("nigga", "ğŸŒ¸");
dictionaryBadWords.set("nigger", "ğŸŒ¸");
dictionaryBadWords.set("nique", "ğŸŒ¸");
dictionaryBadWords.set("nique ta mÃ¨re", "ğŸŒ¸");
dictionaryBadWords.set("peau rouge", "ğŸŒ¸");
dictionaryBadWords.set("pÃ©dale", "ğŸŒ¸");
dictionaryBadWords.set("pÃ©dÃ©", "ğŸŒ¸");
dictionaryBadWords.set("PD", "ğŸŒ¸");
dictionaryBadWords.set("pÃ©tasse", "ğŸŒ¸");
dictionaryBadWords.set("pimbÃªche", "ğŸŒ¸");
dictionaryBadWords.set("pouffiasse", "ğŸŒ¸");
dictionaryBadWords.set("pouffiasse", "ğŸŒ¸");
dictionaryBadWords.set("putain", "ğŸŒ¸");
dictionaryBadWords.set("putasse", "ğŸŒ¸");
dictionaryBadWords.set("pute", "ğŸŒ¸");
dictionaryBadWords.set("racoleuse", "ğŸŒ¸");
dictionaryBadWords.set("retourne dans ton pays", "ğŸŒ¸");
dictionaryBadWords.set("sale arabe", "ğŸŒ¸");
dictionaryBadWords.set("sale bridÃ©", "ğŸŒ¸");
dictionaryBadWords.set("sale juif", "ğŸŒ¸");
dictionaryBadWords.set("sale juive", "ğŸŒ¸");
dictionaryBadWords.set("sale musulman", "ğŸŒ¸");
dictionaryBadWords.set("sale musulmane", "ğŸŒ¸");
dictionaryBadWords.set("sale noir", "ğŸŒ¸");
dictionaryBadWords.set("sale trans", "ğŸŒ¸");
dictionaryBadWords.set("salope", "ğŸŒ¸");
dictionaryBadWords.set("singe noir", "ğŸŒ¸");
dictionaryBadWords.set("tafiole", "ğŸŒ¸");
dictionaryBadWords.set("tantouze", "ğŸŒ¸");
dictionaryBadWords.set("tapette", "ğŸŒ¸");
dictionaryBadWords.set("tapineuse", "ğŸŒ¸");
dictionaryBadWords.set("tarlouse", "ğŸŒ¸");
dictionaryBadWords.set("tchoin", "ğŸŒ¸");
dictionaryBadWords.set("teubÃ©", "ğŸŒ¸");
dictionaryBadWords.set("toubab", "ğŸŒ¸");
dictionaryBadWords.set("trainÃ©e", "ğŸŒ¸");
dictionaryBadWords.set("travelo", "ğŸŒ¸");
dictionaryBadWords.set("va manger du chien", "ğŸŒ¸");
dictionaryBadWords.set("vieille-peau", "ğŸŒ¸");
dictionaryBadWords.set("youpin", "ğŸŒ¸");
dictionaryBadWords.set("youpine", "ğŸŒ¸");

let dictionaryInclusiveWriting = new Map();
dictionaryInclusiveWriting.set("de nombreux", "de multiples");
dictionaryInclusiveWriting.set("de nombreuses", "de multiples");
dictionaryInclusiveWriting.set("les droits de l'Homme", "les droits humains");
dictionaryInclusiveWriting.set("homme politique", "personnalitÃ© politique");
dictionaryInclusiveWriting.set("celui qui", "quiconque");
dictionaryInclusiveWriting.set("Madame le prÃ©fet", "Madame la prÃ©fÃ¨te");
dictionaryInclusiveWriting.set("Madame le directeur", "Madame la directrice");
dictionaryInclusiveWriting.set("Madame le sÃ©nateur", "Madame la sÃ©natrice");
dictionaryInclusiveWriting.set("Madame le maire", "Madame la maire");
dictionaryInclusiveWriting.set("femme de mÃ©nage", "personnel d'entretien");
dictionaryInclusiveWriting.set("mademoiselle", "madame");
dictionaryInclusiveWriting.set("il", "iel");
dictionaryInclusiveWriting.set("elle", "iel");
dictionaryInclusiveWriting.set("ils", "iels");
dictionaryInclusiveWriting.set("elles", "iels");
dictionaryInclusiveWriting.set("les sÃ©nateurs", "les membres du sÃ©nat");
dictionaryInclusiveWriting.set(
  "les parlementaires",
  "les membres du parlement"
);
dictionaryInclusiveWriting.set(
  "Ã  la satisfaction de tous",
  "Ã  la satisfaction gÃ©nÃ©rale"
);
dictionaryInclusiveWriting.set("a Ã©tÃ© violÃ©e", "a Ã©tÃ© victime d'un viol");
dictionaryInclusiveWriting.set("abus sexuel", "agression sexuelle");
dictionaryInclusiveWriting.set("attouchement sexuel", "agression sexuelle");
dictionaryInclusiveWriting.set("pour tous", "pour tout le monde");
dictionaryInclusiveWriting.set("Ã  tous", "Ã  tout le monde");
dictionaryInclusiveWriting.set("acheteur", "acheteur.euse");
dictionaryInclusiveWriting.set("acteur", "acteur.rice");
dictionaryInclusiveWriting.set("adhÃ©rent", "adhÃ©rent.e");
dictionaryInclusiveWriting.set("adjoint", "adjoint.e");
dictionaryInclusiveWriting.set("administrateur", "administrateur.rice");
dictionaryInclusiveWriting.set("administrÃ©", "administrÃ©.e");
dictionaryInclusiveWriting.set("agent", "agent.e");
dictionaryInclusiveWriting.set("agriculteur", "agriculteur.rice");
dictionaryInclusiveWriting.set("ambassadeur", "ambassadeur.rice");
dictionaryInclusiveWriting.set("animateur", "animateur.rice");
dictionaryInclusiveWriting.set("apprenti", "apprenti.e");
dictionaryInclusiveWriting.set("artisan", "artisan.e");
dictionaryInclusiveWriting.set("assistant", "assistant.e");
dictionaryInclusiveWriting.set("attachÃ©", "attachÃ©.e");
dictionaryInclusiveWriting.set("auteur", "auteur.rice");
dictionaryInclusiveWriting.set("avocat", "avocat.e");
dictionaryInclusiveWriting.set("banquier", "banquier.Ã¨re");
dictionaryInclusiveWriting.set("chargÃ©", "chargÃ©.e");
dictionaryInclusiveWriting.set("chef", "chef.fe");
dictionaryInclusiveWriting.set("chercheur", "chercheur.e");
dictionaryInclusiveWriting.set("chroniqueur", "chroniqueur.euse");
dictionaryInclusiveWriting.set("citoyen", "citoyen.ne");
dictionaryInclusiveWriting.set("commis", "commis.e");
dictionaryInclusiveWriting.set("conseiller", "conseiller.Ã¨re");
dictionaryInclusiveWriting.set("consommateur", "consommateur.rice");
dictionaryInclusiveWriting.set("consultant", "consultant.e");
dictionaryInclusiveWriting.set("dÃ©lÃ©guÃ©", "dÃ©lÃ©guÃ©.e");
dictionaryInclusiveWriting.set("dÃ©putÃ©", "dÃ©putÃ©.e");
dictionaryInclusiveWriting.set("diplÃ´mÃ©", "diplÃ´mÃ©.e");
dictionaryInclusiveWriting.set("directeur", "directeur.rice");
dictionaryInclusiveWriting.set("Ã©colier", "Ã©colier.Ã¨re");
dictionaryInclusiveWriting.set("Ã©ducateur", "Ã©ducateur.rice");
dictionaryInclusiveWriting.set("Ã©lecteur", "Ã©lecteur.rice");
dictionaryInclusiveWriting.set("Ã©lu", "Ã©lu.e");
dictionaryInclusiveWriting.set("entraineur", "entraineur.euse");
dictionaryInclusiveWriting.set("entrepreneur", "entrepreneur.e");
dictionaryInclusiveWriting.set("Ã©tudiant", "Ã©tudiant.e");
dictionaryInclusiveWriting.set("footballeur", "footballeur.euse");
dictionaryInclusiveWriting.set("gardien", "gardien.ne");
dictionaryInclusiveWriting.set("gouverneur", "gouverneur.e");
dictionaryInclusiveWriting.set("habitant", "habitant.e");
dictionaryInclusiveWriting.set("hospitalier", "hospitalier.Ã¨re");
dictionaryInclusiveWriting.set("ingÃ©nieur", "ingÃ©nieur.e");
dictionaryInclusiveWriting.set("inspecteur", "inspecteur.rice");
dictionaryInclusiveWriting.set("instituteur", "instituteur.rice");
dictionaryInclusiveWriting.set("intellectuel", "intellectuel.le");
dictionaryInclusiveWriting.set("lycÃ©en", "lycÃ©en.ne");
dictionaryInclusiveWriting.set("mÃ©diateur", "mÃ©diateur.rice");
dictionaryInclusiveWriting.set("modÃ©rateur", "modÃ©rateur.rice");
dictionaryInclusiveWriting.set("officier", "officier.Ã¨re");
dictionaryInclusiveWriting.set("policier", "policier.Ã¨re");
dictionaryInclusiveWriting.set("prÃ©sident", "prÃ©sident.e");
dictionaryInclusiveWriting.set("professeur", "professeur.e");
dictionaryInclusiveWriting.set("professionnel", "professionnel.le");
dictionaryInclusiveWriting.set("programmeur", "programmeur.euse");
dictionaryInclusiveWriting.set("recteur", "recteur.rice");
dictionaryInclusiveWriting.set("remplaÃ§ant", "remplaÃ§ant.e");
dictionaryInclusiveWriting.set("retraitÃ©", "retraitÃ©.e");
dictionaryInclusiveWriting.set("sÃ©nateur", "sÃ©nateur.rice");
dictionaryInclusiveWriting.set("sÃ©nior", "sÃ©nior.e");
dictionaryInclusiveWriting.set("sportif", "sportif.ve");
dictionaryInclusiveWriting.set("supplÃ©ant", "supplÃ©ant.e");
dictionaryInclusiveWriting.set("technicien", "technicien.ne");
dictionaryInclusiveWriting.set("territorial", "territorial.e");
dictionaryInclusiveWriting.set("transporteur", "transporteur.euse");
dictionaryInclusiveWriting.set("travailleur", "travailleur.euse");
dictionaryInclusiveWriting.set("usager", "usager.Ã¨re");
dictionaryInclusiveWriting.set("dÃ©veloppeur", "dÃ©veloppeur.euse");

browser.runtime.onMessage.addListener(addToDictionary);

// Setting regexs so that the world replaced :
// 1. are not part of a longer word,
// 2. are not case and accent sensitive

//function that replaces letters with accents
String.prototype.sansAccents = function () {
  return this.replace(/[Ã¹Ã»Ã¼]/g, "u")
    .replace(/[Ã®Ã¯]/g, "i")
    .replace(/[Ã Ã¢Ã¤]/g, "a")
    .replace(/[Ã´Ã¶]/g, "o")
    .replace(/[Ã©Ã¨ÃªÃ«]/g, "e")
    .replace(/Ã§/g, "c");
};

let regexBadWords = new Map();

for (let element of dictionaryBadWords.keys()) {
  regexBadWords.set(
    element,
    new RegExp("\\b" + element.sansAccents() + "\\b", "gi")
  );
}

let regexInclusiveWriting = new Map();
for (let element of dictionaryInclusiveWriting.keys()) {
  regexInclusiveWriting.set(element, new RegExp("\\b" + element + "\\b", "gi"));
}

// The user can add new words to dictionnary

function addToDictionary(request) {
  if (request.word) {
    dictionaryBadWords.set(request.word, "ğŸŒ¸");
    regexBadWords.set(
      request.word,
      new RegExp("\\b" + request.word + "\\b", "gi")
    );
    replaceText(document.body);
  }
}

function replaceText(node) {
  if (node.nodeType === Node.TEXT_NODE) {
    if (node.parentNode && node.parentNode.nodeName === "TEXTAREA") {
      return;
    }

    let content = node.textContent;
    console.log(document);
    for (let [element, emoji] of dictionaryBadWords) {
      let regex = regexBadWords.get(element);

      if (!document.getElementById("badWordsList")) {
        content = content.sansAccents().replace(regex, emoji);
      }
    }

    node.textContent = content;
  } else {
    for (let i = 0; i < node.childNodes.length; i++) {
      replaceText(node.childNodes[i]);
    }
  }
}

replaceText(document.body);

function replaceTextIncl(node) {
  if (node.nodeType === Node.TEXT_NODE) {
    if (node.parentNode && node.parentNode.nodeName === "TEXTAREA") {
    }

    let content = node.textContent;

    for (let [element, inclWord] of dictionaryInclusiveWriting) {
      let regex = regexInclusiveWriting.get(element);

      content = content.replace(regex, inclWord);
    }

    node.textContent = content;
  } else {
    for (let i = 0; i < node.childNodes.length; i++) {
      replaceTextIncl(node.childNodes[i]);
    }
  }
}

replaceTextIncl(document.body);

const observer = new MutationObserver((mutations) => {
  mutations.forEach((mutation) => {
    if (mutation.addedNodes && mutation.addedNodes.length > 0) {
      for (let i = 0; i < mutation.addedNodes.length; i++) {
        const newNode = mutation.addedNodes[i];
        replaceText(newNode);
      }
    }
  });
});
observer.observe(document.body, {
  childList: true,
  subtree: true,
});

// on/off button to activate replaceText()

// function storageAvailable(type) {
//   try {
//     var storage = window[type],
//       x = "__storage_test__";
//     storage.setItem(x, x);
//     storage.removeItem(x);
//     return true;
//   } catch (e) {
//     return (
//       e instanceof DOMException &&
//       // everything except Firefox
//       (e.code === 22 ||
//         // Firefox
//         e.code === 1014 ||
//         // test name field too, because code might not be present
//         // everything except Firefox
//         e.name === "QuotaExceededError" ||
//         // Firefox
//         e.name === "NS_ERROR_DOM_QUOTA_REACHED") &&
//       // acknowledge QuotaExceededError only if there's something already stored
//       storage.length !== 0
//     );
//   }
// }

// const inclusiveWritingCheckbox = document.getElementById(
//   "inclusiveWritingSwitch"
// );

// if (storageAvailable("localStorage")) {
//   // if (!localStorage.getItem("inclusiveWritingSwitch")) {
//   //   localStorage.setItem("inclusiveWritingSwitch", "off");
//   // }
//   if (storage.getItem("inclusiveWritingSwitch") === "on") {
//     document.getElementById("inclusiveWritingSwitch").checked = true;
//     replaceTextIncl(document.body);
//   } else {
//     document.getElementById("inclusiveWritingSwitch").checked = false;
//   }
// } else {
//   console.log("not available - msg user");
// }

// inclusiveWritingCheckbox.addEventListener("change", function (e) {
//   console.log("listener checkbox");
//   if (storage.getItem("inclusiveWritingSwitch") === "on") {
//     storage.setItem("inclusiveWritingSwitch", "off");
//   } else {
//     storage.setItem("inclusiveWritingSwitch", "on");
//   }
// });

// window.addEventListener("storage", function (e) {
//   console.log("listener storage");
//   if (storage.getItem("inclusiveWritingSwitch") === "on") {
//     replaceTextIncl(document.body);
//   } else {
//     replaceTextIncl();
//   }
// });
